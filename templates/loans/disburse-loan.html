{% extends 'members/auth_base.html' %}
{% block page_title %}Disburse Loan {% endblock page_title %}
{% block page_content %}
    {% include 'messages.html' %}
    <div class="card mb-0" id="directory">
      <div class="card-header">
        <h2 class="">Disburse Loan</h2>
      </div>

    <div class="card-body p-2" >
        {% if loan_request %}
            <div class="row">
                <div class="col-md-4">
                    <h3>Loan Details</h3><hr>
                    <table class="table table-responsive table-striped">
                        <tr><td class="text-info">Beneficiary</td><td> : {{ loan_request.requested_by.get_full_name }}</td></tr>
                        <tr><td class="text-info">Date Requested</td><td>: {{ loan_request.date_requested|date:'d-m-Y H:i' }}</td></tr>
                        <tr><td class="text-info">Amount Requested </td><td>: {{ loan_request.amount_requested }}</td></tr>
                        <tr><td class="text-info">Type of loan </td><td>: {{ loan_request.loan.name }}</td></tr>
                        <tr><td class="text-info">Status </td>
                            {% if loan_request.status == 'pending' %}
                                <td class="text-info">: {{ loan_request.status.title }} <i class="fa fa-check-circle-o"> &nbsp; </i></td>
                            {% elif loan_request.status == 'approved' %}
                                <td class="bg-success">: {{ loan_request.status.title }}
                                    <i class="fa fa-check-circle-o"> &nbsp; </i>
                                    <a href="{% url 'loans:approve-loan' pk=loan_request.pk %}">change <i class="fa fa-edit"></i></a>
                                </td>
                            {% elif loan_request.status == 'disbursed' %}
                                <td class="bg-success">: {{ loan_request.status.title }}
                                    <i class="fa fa-check-circle-o"> &nbsp; </i>
                                </td>
                            {% else %}
                                <td class="bg-danger">: {{ loan_request.status.title }}  <i class="fa fa-remove"> &nbsp; </i></td>
                            {% endif %}
                        </tr>
                        <tr><td class="text-info">Member number </td><td>: {{ loan_request.requested_by.member_number }}</td></tr>
                        <tr><td class="text-info">Member since </td><td>: {{ loan_request.requested_by.date_joined|date:'d-M-Y' }}</td></tr>
                        <tr><td class="text-info">Call </td><td>: {{ loan_request.requested_by.phone_number }}</td></tr>
                    </table>
                </div>
                <div class="col-md-1"></div>
                <div class="col-md-7">
                    <h3>Disbursement Terms</h3><hr>
                    {% if not loan_request.status == "disbursed" %}
                        <form class="" action="{% url 'loans:disburse-loan' request_id=loan_request.pk %}" method="post">{% csrf_token %}

                            <p>
                                <table class="table table-striped table-bordered" cellspacing="2">
                                    <tr>
                                        <td colspan="2">Processing fee</td>
                                        <td colspan="2">Amount disbursed</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">{{ form.processing_fee }}</td>
                                        <td colspan="2">{{ form.amount_disbursed }}</td>
                                    </tr>
                                </table>
                            </p>
                            <div class="row">
                                <div class="col-md-3 col-lg-3">
                                    Interest %<br>{{ form.interest_rate }}
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    Using<br>{{ form.interest_on }}
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    Period<br>{{ form.repayment_period }}
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    Unit<br>{{ form.repayment_period_unit }}
                                </div>
                            </div>
                            <p class="mt-4">
                                First due: {{ form.first_due.errors }}{{ form.first_due }}
                                <span class="text-muted text-sm">{{ form.first_due.help_text }}</span>
                            </p>
                            <p class="text-right">
                                {{ form.loan_request.errors }}{{ form.loan_request }}
                                <button class="btn btn-danger btn-group-justified">
                                    disburse <i class="fa fa-send"></i>
                                </button>
                            </p>
                        </form>
                    {% else %}
                        <p>
                            <a href="{% url 'loans:loan-status' pk=loan_request.requested_by_id %}" class="btn btn-success btn-group-justified">
                                Disbursed
                                &nbsp; <i class="fa fa-check-circle"> </i>
                                view status
                            </a>
                        </p>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="alert alert-info">No loan request with that id was found ... </div>
        {% endif %}
    </div>
    <div class="card-footer">

    </div>
    </div>
{% endblock page_content %}